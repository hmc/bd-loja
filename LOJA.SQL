SET SQL DIALECT 3;


CREATE DOMAIN CONTADOR AS
INTEGER
NOT NULL;


CREATE DOMAIN QUANTIDADE AS
NUMERIC(12,4);

CREATE DOMAIN VALOR AS
NUMERIC(18,3);

CREATE TABLE TLOJCLIENTES (
    ID           CONTADOR NOT NULL /* CONTADOR = INTEGER NOT NULL */,
    CPFCNPJ      VARCHAR(14),
    RGIE         VARCHAR(20),
    NOME         VARCHAR(50),
    FANTASIA     VARCHAR(50),
    ENDERECO     VARCHAR(40),
    COMPLEMENTO  VARCHAR(30),
    BAIRRO       VARCHAR(20),
    CODIGOIBGE   INTEGER,
    CEP          VARCHAR(8),
    FONE         VARCHAR(11),
    EMAIL        VARCHAR(50)
);

ALTER TABLE TLOJCLIENTES ADD CONSTRAINT PK_TLOJCLIENTES PRIMARY KEY (ID);

CREATE TABLE TLOJENDERECOENTREGA (
    ID           CONTADOR /* CONTADOR = INTEGER NOT NULL */,
    IDCLIENTE    CONTADOR /* CONTADOR = INTEGER NOT NULL */,
    ENDERECO     VARCHAR(40),
    COMPLEMENTO  VARCHAR(30),
    BAIRRO       VARCHAR(20),
    CIDADE       INTEGER,
    CEP          VARCHAR(8),
    FONE         VARCHAR(11)
);

ALTER TABLE TLOJENDERECOENTREGA ADD CONSTRAINT PK_TLOJENDERECOENTREGA PRIMARY KEY (ID);
ALTER TABLE TLOJENDERECOENTREGA ADD CONSTRAINT FK_TLOJENDERECOENTREGA_1 FOREIGN KEY (IDCLIENTE) REFERENCES TLOJCLIENTES (ID);

CREATE TABLE TLOJPEDIDO (
    IDPEDIDO       CONTADOR NOT NULL /* CONTADOR = INTEGER NOT NULL */,
    IDEMPRESA      VARCHAR(2),
    IDCLIENTE      CONTADOR /* CONTADOR = INTEGER NOT NULL */,
    IDPRODUTO      VARCHAR(6),
    QTDE           QUANTIDADE /* QUANTIDADE = NUMERIC(12,4) */,
    PRECOUNITARIO  VALOR /* VALOR = NUMERIC(18,3) */,
    PRECOTOTAL     VALOR /* VALOR = NUMERIC(18,3) */,
    FRETETOTAL     VALOR /* VALOR = NUMERIC(18,3) */,
    CONDICAOPAGTO  VARCHAR(3),
    /* Id da transacao de pagto junto a operadora de cartao de credito. */
    TRANSACTIONID  INTEGER,
    ENDENTREGA     INTEGER
);

ALTER TABLE TLOJPEDIDO ADD CONSTRAINT PK_TLOJPEDIDO PRIMARY KEY (IDPEDIDO);
ALTER TABLE TLOJPEDIDO ADD CONSTRAINT FK_TLOJPEDIDO_1 FOREIGN KEY (IDEMPRESA) REFERENCES TGEREMPRESA (CODIGO);
ALTER TABLE TLOJPEDIDO ADD CONSTRAINT FK_TLOJPEDIDO_2 FOREIGN KEY (IDCLIENTE) REFERENCES TLOJCLIENTES (ID);
ALTER TABLE TLOJPEDIDO ADD CONSTRAINT FK_TLOJPEDIDO_3 FOREIGN KEY (IDEMPRESA, IDPRODUTO) REFERENCES TESTPRODUTO (EMPRESA, PRODUTO);
ALTER TABLE TLOJPEDIDO ADD CONSTRAINT FK_TLOJPEDIDO_4 FOREIGN KEY (IDEMPRESA, CONDICAOPAGTO) REFERENCES TESTCONDPAGVENDA (EMPRESA, CODIGO);
ALTER TABLE TLOJPEDIDO ADD CONSTRAINT FK_TLOJPEDIDO_5 FOREIGN KEY (ENDENTREGA) REFERENCES TLOJENDERECOENTREGA (ID);

/**
 * Checagem de alteracoes de estoque ocorridas offline.
 * Agrupa o estoque atual de todas as unidades da empresa.
 *
 * Convencoes
 *    Offline: Atividades ocorridas na loja fisica.
 *    Online: Atividades ocorridas na loja virtual.
 */
CREATE TABLE TLOJESTOQUE (
    IDPRODUTO      VARCHAR(6) NOT NULL,
    ESTDISPONIVEL  NUMERIC(18,4),
    /* Possiveis valores para este campo sao:
       0 (zero) = O Drupal precisa atualizar o estoque online.
       1 (um) = O ESTDISPONIVEL nao foi alterado offline desde a ultima checagem.
       
       Toda vez que o ESTDISPONIVEL for alterado pela aplicacao offline esta devera alterar o valor deste
       campo para 0 (zero).
       O Drupal ira mudar este valor para 1 (um) apos atualizar o estoque online. */
    ESTATUALIZADO  VARCHAR(1) NOT NULL,
);